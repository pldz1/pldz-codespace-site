---
author: admin@pldz1.com
category: docker
csdn: ''
date: '2025-08-05'
gitee: ''
github: ''
juejin: ''
serialNo: 1
status: publish
summary: æœ¬ç« æ•´åˆå¸¸è§çš„ Dockerfile ä½¿ç”¨ä¸å®¹å™¨ç®¡ç†å®æˆ˜ç»éªŒ, é‡ç‚¹æ¶µç›–Dockerfile åŸºç¡€ä¸å…³é”®æŒ‡ä»¤, docker build ä¸å¸¸ç”¨é€‰é¡¹,docker
  run ä¸å®¹å™¨è¿è¡Œé€‰é¡¹
tags:
- docker
- dockerfile
thumbnail: /api/v1/website/image/docker/dockerfile-blog-thumbnail.png
title: dockerfileåˆ›å»ºè‡ªå·±çš„é•œåƒ
---

# Dockerfile éšç¬”

æœ¬ç« æ•´åˆå¸¸è§çš„ Dockerfile ä½¿ç”¨ä¸å®¹å™¨ç®¡ç†å®æˆ˜ç»éªŒï¼Œé‡ç‚¹æ¶µç›–

* **åŸºæœ¬æ¦‚å¿µ**ï¼šé•œåƒã€å®¹å™¨ã€æ ‡ç­¾ã€å®¹å™¨çŠ¶æ€ä¿å­˜
* **Dockerfile åŸºç¡€ä¸å…³é”®æŒ‡ä»¤**
* **`docker build` ä¸å¸¸ç”¨é€‰é¡¹**
* **`docker run` ä¸å®¹å™¨è¿è¡Œé€‰é¡¹**

---

## 0. å…ˆç›´æ¥ä½“éªŒ

1. åˆ›å»ºä¸€ä¸ª `Dockerfile` æ–‡ä»¶
2. æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Nginx é•œåƒ
FROM nginx

# ç›´æ¥å†™å…¥ä¸€ä¸ªç®€å•çš„ HTML æ–‡ä»¶
RUN echo "<h1>Hello world from Docker!</h1>" \
    > /usr/share/nginx/html/index.html
```

3. æ‰§è¡ŒæŒ‡ä»¤ `docker build -t my-nginx-html .`
4. æ‰§è¡Œ `docker run -d -p 8080:80 my-nginx-html`
5. æ‰“å¼€ `http://localhost:8080`

![dockerfile-demo-logs](/api/v1/website/image/docker/dockerfile-demo-logs.png)

![dockerfile-demo-html-preview](/api/v1/website/image/docker/dockerfile-demo-html-preview.png)



## 1. Dockerfile æ˜¯å®šä¹‰é•œåƒæ„å»ºæµç¨‹çš„è„šæœ¬ 

ğŸ³ Dockerfile æ˜¯ä¸€ä»½æ–‡æœ¬è„šæœ¬ï¼ŒæŒ‰åºå®šä¹‰é•œåƒæ„å»ºæµç¨‹ã€‚

### å‡ ä¸ªå¸¸ç”¨çš„æŒ‡ä»¤


| æŒ‡ä»¤            | ä½œç”¨                                   |
| ------------- | ------------------------------------ |
| `FROM`        | æŒ‡å®šåŸºç¡€é•œåƒï¼Œå¿…éœ€ã€‚                           |
| `WORKDIR`     | åˆ‡æ¢/åˆ›å»ºå·¥ä½œç›®å½•ï¼›åç»­æŒ‡ä»¤åœ¨æ­¤æ‰§è¡Œã€‚                  |
| `COPY`/`ADD`  | æ‹·è´æ–‡ä»¶åˆ°é•œåƒï¼›`ADD` æ”¯æŒ URL å’Œè‡ªåŠ¨è§£å‹ tar åŒ…ã€‚    |
| `RUN`         | æ‰§è¡Œå‘½ä»¤ï¼ˆå®‰è£…ä¾èµ–ã€ç¼–è¯‘ç­‰ï¼‰ï¼Œç”Ÿæˆæ–°é•œåƒå±‚ã€‚               |
| `ENV`         | è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå½±å“åç»­æ„å»ºå’Œè¿è¡Œæ—¶ç¯å¢ƒã€‚                 |
| `ARG`         | æ„å»ºå‚æ•°ï¼Œä»…åœ¨ build é˜¶æ®µå¯ç”¨ï¼Œä¸ä¼šä¿ç•™åˆ°æœ€ç»ˆé•œåƒã€‚        |
| `EXPOSE`      | å£°æ˜å®¹å™¨è¿è¡Œæ—¶ç›‘å¬çš„ç«¯å£ï¼ˆæ–‡æ¡£åŒ–ä½œç”¨ï¼Œéœ€é…åˆç«¯å£æ˜ å°„ï¼‰ã€‚         |
| `VOLUME`      | å®šä¹‰æ•°æ®å·æŒ‚è½½ç‚¹ï¼Œç”¨äºæŒä¹…åŒ–æˆ–å…±äº«æ•°æ®ã€‚                 |
| `ENTRYPOINT`  | è®¾ç½®å®¹å™¨å…¥å£ç‚¹ï¼Œå¯é…åˆ `CMD` ä¼ é€’å‚æ•°ï¼Œä¸æ˜“è¢«è¦†ç›–ã€‚        |
| `CMD`         | é»˜è®¤å¯åŠ¨å‘½ä»¤ï¼Œå¯è¢« `docker run` æˆ– Compose è¦†ç›–ã€‚ |
| `HEALTHCHECK` | å®šä¹‰å¥åº·æ£€æŸ¥å‘½ä»¤ï¼ŒDocker å®šæœŸè¿è¡Œåˆ¤æ–­æœåŠ¡çŠ¶æ€ã€‚          |

**åˆšåˆšçš„ç¤ºä¾‹å°±æ˜¯ä¸€ä¸ªæœ€å°çš„æŒ‡å®šè¦æ„å»ºä»€ä¹ˆæ ·çš„dockeré•œåƒçš„æµç¨‹**ï¼š

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Nginx é•œåƒ
FROM nginx

# ç›´æ¥å†™å…¥ä¸€ä¸ªç®€å•çš„ HTML æ–‡ä»¶
RUN echo "<h1>Hello world from Docker!</h1>" \
    > /usr/share/nginx/html/index.html
```

### å†çœ‹ä¸‹å…¶ä»–çš„å†…å®¹ 

å¦‚æœèƒ½æˆåŠŸçš„æ‰“å¼€äº†åˆšåˆšä½“éªŒçš„ç½‘é¡µ é‚£ä¹ˆæˆ‘ä»¬è¾“å…¥ä¸‹é¢æŒ‡ä»¤çœ‹çœ‹

1. æ‰§è¡Œ `docker images` çœ‹çœ‹

```bash
pldz:~/local/docker-demo$ docker images
REPOSITORY                                        TAG       IMAGE ID       CREATED         SIZE
my-nginx-html                                     latest    7b2a8ce8091b   3 minutes ago   192MB
```

2. æ‰§è¡Œ `docker ps -a` çœ‹çœ‹

```bash
pldz:~/local/docker-demo$ docker ps -a
CONTAINER ID   NAMES               STATUS
fe34ca2893c0   blissful_roentgen   Up 5 minutes
```

å¥½äº† å¦‚æœèƒ½æˆåŠŸçœ‹è§è¿™äº›ä¿¡æ¯ é‚£æˆ‘ä»¬è¿›å…¥ä¸‹ä¸€æ­¥ çœ‹çœ‹è¿™äº›éƒ½æ˜¯ä»€ä¹ˆæ„æ€.


### ä»€ä¹ˆæ˜¯é•œåƒ/å®¹å™¨/æ ‡ç­¾

* **é•œåƒï¼ˆImageï¼‰**ï¼šåªè¯»æ¨¡æ¿ï¼ŒåŒ…å«æ“ä½œç³»ç»Ÿå±‚ã€ä¾èµ–å’Œåº”ç”¨ä»£ç ï¼Œç”¨äºåˆ›å»ºå®¹å™¨ã€‚
* **å®¹å™¨ï¼ˆContainerï¼‰**ï¼šé•œåƒçš„å¯è¿è¡Œå®ä½“ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œè¿›ç¨‹ç©ºé—´ã€‚
* **æ ‡ç­¾ï¼ˆTagï¼‰**ï¼šé•œåƒçš„å¯è¯»åç§°åç¼€ï¼Œæ ¼å¼ä¸º `name:tag`ï¼Œç”¨äºåŒºåˆ†ä¸åŒç‰ˆæœ¬æˆ–å˜ä½“ã€‚
---


## 2. æ„å»º docker é•œåƒ


### æ¦‚å¿µèƒŒä¹¦ ğŸ˜µâ€ğŸ’« 

åœ¨ Docker é‡Œï¼Œå¯ä»¥ç”¨ `docker build`ï¼ˆæˆ–åŒä¹‰çš„ `docker image build`ï¼‰åŸºäº Dockerfile åšå¯é‡ç°çš„å•å¹³å°æ„å»ºï¼›ç”¨ `docker buildx build` åˆ©ç”¨ BuildKit åšå¤šå¹³å°ã€é«˜çº§ç¼“å­˜çš„æ„å»ºï¼›ç”¨ `docker commit` å°†è¿è¡Œä¸­å®¹å™¨å¿«ç…§æˆé•œåƒï¼ˆä¸å¯é‡ç°ï¼Œä»…ç”¨äºå¿«é€Ÿå®éªŒï¼‰ï¼›ç”¨ `docker load`ï¼`docker import` ä» tar åŒ…æ¢å¤æˆ–å¯¼å…¥é•œåƒã€‚ä¸‹è¡¨å¯¹æ¯”äº†å„å‘½ä»¤çš„æ¥æºã€å¯é‡ç°æ€§å’Œå…¸å‹åœºæ™¯ï¼š

| å‘½ä»¤                                    | æ„å»ºæ¥æº                    | å¯é‡ç°æ€§      | å…¸å‹åœºæ™¯              |
| ------------------------------------- | ----------------------- | --------- | ----------------- |
| `docker build` / `docker image build` | Dockerfile + ä¸Šä¸‹æ–‡        | é«˜         | æœ¬åœ°å¸¸è§„å•å¹³å°æ„å»º         |
| `docker buildx build`                 | Dockerfile + ä¸Šä¸‹æ–‡        | æ›´é«˜ï¼ˆæ”¯æŒå¤šå¹³å°ï¼‰ | å¤šæ¶æ„é•œåƒæ„å»ºï¼ŒCI/CD æµæ°´çº¿ |
| `docker commit`                       | è¿è¡Œä¸­å®¹å™¨                   | ä½         | å®éªŒè°ƒè¯•ã€å¿«é€Ÿå¿«ç…§         |
| `docker load`                         | `docker save` å¯¼å‡ºçš„ tar åŒ… | ä¸å¯¼å‡ºæ—¶ä¸€è‡´    | æ¢å¤æˆ–è¿ç§»é•œåƒ           |
| `docker import`                       | ä»»æ„æ ¼å¼çš„ tar åŒ…             | å–å†³äºæ¥æº     | ä»éæ ‡å‡† tar å¯¼å…¥é•œåƒ     |



### `docker build` ä¸å¸¸ç”¨é€‰é¡¹

```bash
docker build [OPTIONS] -t <image_name>:<tag> <context_dir>
```

* `-t name:tag`ï¼šä¸ºé•œåƒå‘½åå¹¶æ‰“æ ‡ç­¾ã€‚
* `-f Dockerfile`ï¼šæŒ‡å®š Dockerfile æ–‡ä»¶ã€‚
* `--target stage`ï¼šåœ¨å¤šé˜¶æ®µæ„å»ºä¸­ä»…æ„å»ºæŒ‡å®šé˜¶æ®µã€‚
* `--build-arg KEY=VALUE`ï¼šä¼ é€’æ„å»ºå‚æ•°ã€‚

**ç¤ºä¾‹**ï¼š

```bash
docker build -t my-nginx-html .
```

---

## 3. è¿è¡Œ docker é•œåƒ


### æ¦‚å¿µèƒŒä¹¦ ğŸ˜µâ€ğŸ’« 

æŠŠé•œåƒâ€œè·‘èµ·æ¥â€ä¸»è¦å¯ä»¥åˆ†ä¸ºå››å¤§ç±»æ–¹å¼ï¼š

* **å•æœºå‘½ä»¤**ï¼šç›´æ¥åœ¨æœ¬åœ°åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼›
* **Compose ç¼–æ’**ï¼šä½¿ç”¨ `docker-compose` ç®¡ç†å¤šå®¹å™¨åº”ç”¨ï¼›
* **Swarm/é›†ç¾¤**ï¼šåœ¨ Docker Swarm æ¨¡å¼ä¸‹éƒ¨ç½²æœåŠ¡ï¼›
* **äº‘åŸç”Ÿ/Kubernetes**ï¼šé€šè¿‡ Kubernetes æˆ– Helm åœ¨é›†ç¾¤ä¸­è°ƒåº¦ã€‚

| ç±»åˆ«             | å‘½ä»¤ï¼å·¥å…·                             | è¯´æ˜                                   |
| -------------- | --------------------------------- | ------------------------------------ |
| **å•æœºå‘½ä»¤**       | `docker run`                      | ä¸€æ­¥åˆ°ä½ï¼Œåˆ›å»ºå¹¶å¯åŠ¨æ–°å®¹å™¨                        |
|                | `docker create` + `docker start`  | åˆ†æ­¥ï¼šå…ˆå»ºå®¹å™¨ï¼ˆä¸å¯åŠ¨ï¼‰ã€å†å¯åŠ¨ï¼›æ›´çµæ´»åœ°åˆ†ç¦»åˆ›å»ºä¸è¿è¡Œ         |
|                | `docker exec`                     | åœ¨å·²è¿è¡Œå®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ï¼ˆå¸¸ç”¨ `-it sh` è¿›å…¥äº¤äº’å¼ Shellï¼‰ |
|                | `docker Desktop`ï¼ˆGUIï¼‰             | é€šè¿‡å›¾å½¢ç•Œé¢ç‚¹å‡»å¯åŠ¨                           |
| **Compose ç¼–æ’** | `docker-compose up`               | åŸºäº `docker-compose.yml` ä¸€é”®å¯åŠ¨/é‡å»ºå¤šå®¹å™¨æœåŠ¡ |
|                | `docker compose up`               | Docker å®˜æ–¹æ–°ç‰ˆ CLI æ’ä»¶å½¢å¼                 |
| **Swarm/é›†ç¾¤**   | `docker swarm init`               | åˆå§‹åŒ– Swarm é›†ç¾¤                         |
|                | `docker service create`           | åœ¨ Swarm ä¸Šéƒ¨ç½²å•ä¸ªæœåŠ¡                      |
|                | `docker stack deploy`             | æ ¹æ® Compose æ–‡ä»¶éƒ¨ç½²å®Œæ•´åº”ç”¨æ ˆ                 |
| **äº‘åŸç”Ÿ/K8s**    | `kubectl run`                     | æœ€åŸºæœ¬çš„å• Pod è¿è¡Œå‘½ä»¤                       |
|                | `kubectl apply -f deployment.yml` | ç”¨ Deployment/YAML æè¿°å¯åŠ¨å®¹å™¨ç»„            |
|                | `helm install`                    | é€šè¿‡ Helm Chart å®‰è£…ã€å‡çº§å¤æ‚åº”ç”¨              |
|                | `k3s` / `minikube`                | æœ¬åœ° Kubernetes å‘è¡Œç‰ˆï¼Œå¯ç”¨åŒæ ·å‘½ä»¤è·‘èµ·é•œåƒ         |

æ¯ç§æ–¹å¼éƒ½æœ‰è‡ªå·±é€‚ç”¨çš„åœºæ™¯ï¼š

1. **å¿«é€Ÿæµ‹è¯•æˆ–å¼€å‘**ï¼šç”¨ `docker run`ï¼`docker exec`ï¼›
2. **æœ¬åœ°å¤šå®¹å™¨ä¾èµ–**ï¼šç”¨ Composeï¼›
3. **å¤šä¸»æœºé«˜å¯ç”¨**ï¼šç”¨ Swarmï¼›
4. **ç”Ÿäº§çº§äº‘åŸç”Ÿ**ï¼šç”¨ Kubernetes æˆ– Helmã€‚



### `docker run` ä¸å®¹å™¨è¿è¡Œé€‰é¡¹ 

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

* `-d`ï¼šåå°è¿è¡Œã€‚
* `-p hostPort:containerPort`ï¼šç«¯å£æ˜ å°„ã€‚
* `--name NAME`ï¼šæŒ‡å®šå®¹å™¨åç§°ã€‚
* `-v hostPath:containerPath[:ro|rw]`ï¼šæŒ‚è½½å·æˆ–ä¸»æœºç›®å½•ã€‚
* `--env KEY=VALUE`ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ã€‚
* `--env-file path`ï¼šä»æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ã€‚
* `--rm`ï¼šå®¹å™¨åœæ­¢åè‡ªåŠ¨åˆ é™¤ã€‚
* `--network NETWORK`ï¼šæŒ‡å®šç½‘ç»œæ¨¡å¼ã€‚

**ç¤ºä¾‹**ï¼š

```bash
docker run -d -p 8080:80 my-nginx-html
```

---